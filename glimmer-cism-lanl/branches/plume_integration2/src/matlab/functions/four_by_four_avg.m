function res = four_by_four_avg(M)

res = 1/16.0 *( ...
      M(1:end-3,1:end-3,:)+M(1:end-3,2:end-2,:)+...
      M(1:end-3,3:end-1,:)+M(1:end-3,4:end-0,:)+...
      M(2:end-2,1:end-3,:)+M(2:end-2,2:end-2,:)+...
      M(2:end-2,3:end-1,:)+M(2:end-2,4:end-0,:)+...
      M(3:end-1,1:end-3,:)+M(3:end-1,2:end-2,:)+...
      M(3:end-1,3:end-1,:)+M(3:end-1,4:end-0,:)+...
      M(4:end-0,1:end-3,:)+M(4:end-0,2:end-2,:)+...
      M(4:end-0,3:end-1,:)+M(4:end-0,4:end-0,:) );
  
  
 [m,n] = size(M);
 
 for i=1:(m-3)
     for j=1:(n-3)
         
         res(i,j) = sum(sum(M(i:(i+3),j:(j+3))))/16.0;
     end
 end
 